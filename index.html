<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Passport Validity Checker</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 40px;
}

.container {
  background: #ffffff;
  padding: 25px;
  max-width: 520px;
  margin: auto;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

h2 {
  text-align: center;
}

label {
  display: block;
  margin-top: 12px;
  font-weight: bold;
}

input, button {
  width: 100%;
  padding: 8px;
  margin-top: 5px;
}

button {
  margin-top: 20px;
  font-size: 16px;
  cursor: pointer;
}

.result {
  margin-top: 15px;
  padding: 10px;
  text-align: center;
  font-weight: bold;
  border-radius: 5px;
}

.valid {
  background: #d4edda;
  color: #155724;
}

.invalid {
  background: #f8d7da;
  color: #721c24;
}

.hidden {
  display: none;
}
</style>
</head>

<body>

<div class="container">

<!-- STEP 1 -->
<div id="step1">
  <h2>Enter Your Name</h2>

  <label>Entered By</label>
  <input type="text" id="enteredBy">

  <button onclick="goToStep2()">Continue</button>
</div>

<!-- STEP 2 -->
<div id="step2" class="hidden">
  <h2>Passport Validity Checker</h2>

  <label>First Name</label>
  <input type="text" id="firstName">

  <label>Last Name</label>
  <input type="text" id="lastName">

  <label>Passport Number</label>
  <input type="text" id="passportNumber">

  <label>Travel Date</label>
  <input type="date" id="travelDate">

  <label>Passport Expiry Date</label>
  <input type="date" id="expiryDate">

  <button onclick="checkAndSave()">Check & Save</button>

  <div id="result" class="result"></div>
</div>

</div>

<script>
const SCRIPT_URL =
"https://script.google.com/macros/s/AKfycby8upXPLdKsp9gah6RDMN2q5BpljWTZfTdYnUkvw6xSnUNuMSDsydydsIO37c5lGUg/exec";

// Auto-set travel date to today
document.getElementById("travelDate").value =
  new Date().toISOString().split("T")[0];

function goToStep2() {
  const enteredBy = document.getElementById("enteredBy").value.trim();

  if (!enteredBy) {
    alert("Please enter your name");
    return;
  }

  document.getElementById("step1").classList.add("hidden");
  document.getElementById("step2").classList.remove("hidden");
}

function checkAndSave() {

  const result = document.getElementById("result");

  const travelDateVal = travelDate.value;
  const expiryDateVal = expiryDate.value;

  if (!expiryDateVal) {
    result.textContent = "Please enter passport expiry date";
    result.className = "result invalid";
    return;
  }

  const travelDateObj = new Date(travelDateVal);
  const expiryDateObj = new Date(expiryDateVal);

  const requiredDate = new Date(travelDateObj);
  requiredDate.setMonth(requiredDate.getMonth() + 6);

  const validity =
    expiryDateObj >= requiredDate ? "VALID" : "INVALID";

  // Show result immediately
  if (validity === "VALID") {
    result.textContent = "Passport is VALID ✅ (Data saved)";
    result.className = "result valid";
  } else {
    result.textContent = "Passport is NOT valid ❌ (Data saved)";
    result.className = "result invalid";
  }

  // Fire-and-forget save
  fetch(SCRIPT_URL, {
    method: "POST",
    mode: "no-cors",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      enteredBy: enteredBy.value,
      firstName: firstName.value,
      lastName: lastName.value,
      passportNumber: passportNumber.value,
      travelDate: travelDateVal,
      expiryDate: expiryDateVal,
      validity: validity,
      timestamp: new Date().toISOString()
    })
  });
}
</script>

</body>
</html>
